{"title": "Deploy dotnet Core MVC on Ubuntu with Supervisor", "content": "<h2>Introduction</h2>\n<p>I Just purchased a Linux VPS and started to install dotnet core on it and use it for deploying dotnet core apps</p>\n<h2>Removing Apache</h2>\n<p>Most of Linux vps comes with apache so first step is to remove it.</p>\n<pre><code data-enlighter-language=\"null\">sudo service apache2 stop\r\nsudo apt-get purge apache2 \r\nsudo apt-get autoremove\r\n</code></pre>\n<p>Finally, check if there is any configuration files or manual pages belonging to Apache2, which are still not removed.</p>\n<pre><code data-enlighter-language=\"null\">whereis apache2\r\nsudo rm -rf /etc/apache2</code></pre>\n<h2>Installing Dotnet</h2>\n<p>Head over to\u00a0<a href=\"http://dot.net/?WT.mc_id=-blog-scottha\">http://dot.net</a>\u00a0to get .NET Core and follow the instructions. There\u2019s at least 8 Linuxes supported in 6 flavors so you should have no trouble. I followed the Ubuntu instructions.</p>\n<h2>Make ASP.Net Core MVC Application</h2>\n<pre><code data-enlighter-language=\"null\">dotnet new mvc -o mvc1</code></pre>\n<p>Now we have created our MVC application we need to make some modification on it to work without any issues.</p>\n<h3>Disable HTTPS</h3>\n<p>due to we doesn\u2019t have https certificate we are going to disable HTTPS and let the server only listen to port 80, we also will not use nginx</p>\n<h4>Update Program.cs</h4>\n<pre><code data-enlighter-language=\"null\">using System.Net;\r\nusing Microsoft.AspNetCore;\r\nusing Microsoft.AspNetCore.Hosting;\r\n\r\nnamespace mvc1\r\n{\r\n    public class Program\r\n    {\r\n        public static void Main(string[] args)\r\n        {\r\n            CreateWebHostBuilder(args).Build().Run();\r\n        }\r\n\r\n        public static IWebHostBuilder CreateWebHostBuilder(string[] args) =&gt;\r\n            WebHost.CreateDefaultBuilder(args)\r\n                .UseStartup&lt;Startup&gt;()\r\n                .ConfigureKestrel((context, options) =&gt;\r\n                {\r\n                    options.Listen(IPAddress.Any, 80, listenOptions =&gt;\r\n                    {\r\n                    });\r\n                });\r\n\r\n\r\n\r\n    }\r\n}\r\n</code></pre>\n<h4>Update Startup.cs</h4>\n<p>Comment both theses lines\u00a0\u00a0<code>//app.UseHsts();\u00a0</code>and\u00a0\u00a0<code>//app.UseHttpsRedirection();</code></p>\n<h4>Remove launchsetting.json</h4>\n<p>we also going to remove file launchsetting.json from Properties directory.</p>\n<h4>Build the Application</h4>\n<pre><code data-enlighter-language=\"null\">dotnet build</code></pre>\n<p>Test the application</p>\n<pre><code data-enlighter-language=\"null\">dotnet run</code></pre>\n<h2>Publish the Application</h2>\n<pre><code data-enlighter-language=\"null\">dotnet publish -c release -r ubuntu.16.04-x64</code></pre>\n<h2>Supervisor</h2>\n<p><a href=\"http://supervisord.org/index.html\">Supervisor</a>\u00a0is a client/server system that allows its users to monitor and control a number of processes on UNIX-like operating systems. It is used to control processes related to a project or a customer and is meant to start like any other program at boot time. Supervisor is simple, centralized, efficient, extensible, compatible and\u00a0<a href=\"http://supervisord.org/introduction.html#features\">proven</a>.</p>\n<p>The components of Supervisor are:</p>\n<ul>\n<li><strong>supervisord</strong>: This is the server piece of supervisor is named supervisord. It is responsible for starting child programs at its own invocation, responding to commands from clients, restarting crashed or exited subprocesseses, logging its subprocess stdout and stderr output, and generating and handling \u201cevents\u201d corresponding to points in subprocess lifetimes.</li>\n<li><strong>supervisorctl</strong>: The command-line client piece of the supervisor is named supervisorctl. It provides a shell-like interface to the features provided by supervisord.</li>\n<li><strong>Web Server</strong>: A (sparse) web user interface with functionality comparable to supervisorctl</li>\n<li><strong>XML-RPC Interface</strong>: The same HTTP server which serves the web UI serves up an XML-RPC interface that can be used to interrogate and control supervisor and the programs it runs.</li>\n</ul>\n<p>In this guide, we will install the latest version of\u00a0<strong>supervisor</strong>, show how to spawn and manage programs through\u00a0<strong>supervisorctl</strong>, and lastly configure a web interface to manage our dotnet programs.</p>\n<p>Supervisor is known to work with Python 2.4 or later but will not work under any version of Python 3.<br />\nTo check what version of Python is installed on your system, type the command below:</p>\n<pre><code data-enlighter-language=\"null\">python --version\r\n</code></pre>\n<h3>Install Supervisor</h3>\n<pre><code data-enlighter-language=\"null\">sudo apt-get install supervisor</code></pre>\n<h3>Enable Web Interface for Supervisor</h3>\n<pre><code data-enlighter-language=\"null\">nano /etc/supervisor/supervisord.conf</code></pre>\n<p>Add these line at the end of the file</p>\n<pre><code data-enlighter-language=\"null\">[inet_http_server]\r\nport=*:9001\r\nusername=user\r\npassword=123\r\n</code></pre>\n<h3>Create Our Supervisor Service for our dotnet application</h3>\n<pre><code data-enlighter-language=\"null\">nano /etc/supervisor/conf.d/dotnetmvc1.conf</code></pre>\n<p>Add the following lines and update it with your dotnet path</p>\n<pre><code data-enlighter-language=\"null\">[program:dotnetMVC1]\r\ncommand=/usr/bin/dotnet /root/dotnet/mvc1/bin/release/netcoreapp2.2/ubuntu.16.04-x64/publish/mvc1.dll\r\ndirectory=/root/dotnet/mvc1/bin/release/netcoreapp2.2/ubuntu.16.04-x64/publish/\r\nautostart=true\r\nautorestart=true\r\nstderr_logfile=/var/log/dotnettest.err.log\r\nstdout_logfile=/var/log/dotnettest.out.log\r\nenvironment=ASPNETCORE_ENVIRONMENT=Production\r\nuser=root\r\nstopsignal=INT\r\n</code></pre>\n<h3>Enable Supervisor</h3>\n<pre><code data-enlighter-language=\"null\">sudo systemctl enable  supervisor \r\nsudo service supervisor restart</code></pre>\n<h3>Browse Supervisor Link on yourserverIP:9001</h3>\n<p><a href=\"https://emolike.net/wp-content/uploads/2019/06/DeepinScreenshot_select-area_20190601164458.png\"><img class=\"alignnone size-full wp-image-1433\" src=\"https://emolike.net/wp-content/uploads/2019/06/DeepinScreenshot_select-area_20190601164458.png\" alt=\"\" width=\"1056\" height=\"293\" /></a></p>\n<h2>Congratulations the app is deployed</h2>\n<p><a href=\"https://emolike.net/wp-content/uploads/2019/06/DeepinScreenshot_select-area_20190601173004.png\"><img class=\"alignnone size-full wp-image-1435\" src=\"https://emolike.net/wp-content/uploads/2019/06/DeepinScreenshot_select-area_20190601173004.png\" alt=\"\" width=\"1919\" height=\"1007\" srcset=\"https://emolike.net/wp-content/uploads/2019/06/DeepinScreenshot_select-area_20190601173004.png 1919w, https://emolike.net/wp-content/uploads/2019/06/DeepinScreenshot_select-area_20190601173004-300x157.png 300w, https://emolike.net/wp-content/uploads/2019/06/DeepinScreenshot_select-area_20190601173004-768x403.png 768w, https://emolike.net/wp-content/uploads/2019/06/DeepinScreenshot_select-area_20190601173004-1024x537.png 1024w\" sizes=\"(max-width: 1919px) 100vw, 1919px\" /></a></p>\n<p> </p>\n", "slug": "deploy-dotnet-core-mvc-on-ubuntu-with-supervisor", "date": 1559403100, "cats": [0, 13, 8, 1, 11, 4, 5, 15]}