{"title": "Host a web app with letsencrypt with traefik and cert manager on k3s", "content": "<h4>1- Setup you subdomain or domain in Cloudflare or your host to point to your server ip</h4>\n<h3>&#8212;</h3>\n<h4>2- Install cert-manager</h4>\n<pre><code data-enlighter-language=\"null\">kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v0.14.1/cert-manager.yaml\r\n</code></pre>\n<h4>3-Apply the letsencrypt-issuer-production.yaml</h4>\n<pre><code data-enlighter-language=\"null\">apiVersion: cert-manager.io/v1alpha2\r\nkind: ClusterIssuer\r\nmetadata:\r\n  name: letsencrypt-prod\r\nspec:\r\n  acme:\r\n    # The ACME server URL\r\n    server: https://acme-v02.api.letsencrypt.org/directory\r\n    # Email address used for ACME registration\r\n    email: emmmmmmail@gmail.com\r\n    # Name of a secret used to store the ACME account private key\r\n    privateKeySecretRef:\r\n      name: letsencrypt-prod\r\n    # Enable the HTTP-01 challenge provider\r\n    solvers:\r\n    - http01:\r\n        ingress:\r\n          class: traefik</code></pre>\n<h4>4- Apply the application deployment and Ingress</h4>\n<pre><code data-enlighter-language=\"null\">apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: app1-deployment\r\n  labels:\r\n    app: app1\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      app: app1\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: app1\r\n    spec:\r\n      containers:\r\n      - name: app1\r\n        image: nginx\r\n        ports:\r\n        - containerPort: 80\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: app1-service\r\nspec:\r\n  selector:\r\n    app: app1\r\n  ports:\r\n    - protocol: TCP\r\n      port: 80\r\n---\r\napiVersion: networking.k8s.io/v1beta1\r\nkind: Ingress\r\nmetadata:\r\n  name: app1-ingress\r\n  annotations:\r\n    kubernetes.io/ingress.class: \"traefik\"\r\n    traefik.frontend.rule.type: PathPrefixStrip\r\n    cert-manager.io/cluster-issuer: letsencrypt-prod\r\n\r\nspec:\r\n  rules:\r\n  - host: k8.eramax.net\r\n    http:\r\n      paths:\r\n      - path: /app1\r\n        backend:\r\n          serviceName: app1-service\r\n          servicePort: 80\r\n  tls:\r\n  - hosts:\r\n    - k8.eramax.net\r\n    secretName: k8-eramax-net-tls</code></pre>\n<h4>5- Check your certificate issued successfully or there is an error</h4>\n<pre><code data-enlighter-language=\"null\">kubectl get certificate\r\n\r\n#In case of errors\r\nkubectl  describe orders\r\nkubectl  describe challenges</code></pre>\n<p>This video is very helpful for these steps</p>\n<p><iframe title=\"Installing and using cert-manager with k3s\" width=\"640\" height=\"360\" src=\"https://www.youtube.com/embed/BlzRx6ROiX0?start=900&feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe></p>\n<pre><code data-enlighter-language=\"null\">https://carpie.net/articles/installing-and-using-cert-manager-with-k3s</code></pre>\n<p> </p>\n<p> </p>\n", "slug": "host-a-web-app-with-letsencrypt-with-traefik-and-cert-manager-on-k3s", "date": 1585769912, "cats": [7, 0, 1, 10, 2, 3, 4]}