{"title": "How to install Active Directory && Connect to AD using C#", "content": "<p><iframe title=\"How to install Active Directory (AD) Domain Services in Windows server 2012 R2\" width=\"640\" height=\"360\" src=\"https://www.youtube.com/embed/-BqNC3s5-ec?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe></p>\n<p> </p>\n<pre><code data-enlighter-language=\"csharp\">using System;\r\nusing System.DirectoryServices.AccountManagement;\r\nnamespace AD1\r\n{\r\n    class Program\r\n    {\r\n        static void Main(string[] args)\r\n        {\r\n            ActiveDirectory ac = new ActiveDirectory();\r\n            Console.WriteLine(\"Login : \" + ac.Login(\"eramax@domain.local\", \"x\"));\r\n            Console.WriteLine(\"Search For eramax : \" + ac.Search(\"eramax\"));\r\n            Console.WriteLine(\"Search For eramax@domain.local : \" + ac.SearchByEmail(\"eramax@domain.local\"));\r\n            Console.WriteLine(\"Print All Users in AD\" ); ac.GetAllUsers();\r\n            Console.ReadLine();\r\n        }\r\n\r\n    }\r\n    public class ActiveDirectory\r\n    {\r\n        private static string LDAPServerIP = \"x.x.x.x\";\r\n        private static string ADDomain = \"domain.local\";\r\n        private static string ADUsername = \"x@domain.local\";\r\n        private static string ADPassword = \"x\";\r\n        public bool Login(string username, string pass)\r\n        {\r\n            using (PrincipalContext ctx = new PrincipalContext(ContextType.Domain, LDAPServerIP , ADUsername, ADPassword))\r\n            {\r\n                bool userValid = ctx.ValidateCredentials(username, pass);\r\n                return userValid;\r\n            }\r\n        }\r\n\r\n        public string Search(string userName)\r\n        {\r\n            PrincipalContext ctx = new PrincipalContext(ContextType.Domain, LDAPServerIP, ADUsername, ADPassword);\r\n            var user = UserPrincipal.FindByIdentity(ctx, IdentityType.SamAccountName, ADDomain + \"\\\\\" + userName);\r\n            return user != null ? user.UserPrincipalName : null;\r\n        }\r\n        public string SearchByEmail(string userName)\r\n        {\r\n            PrincipalContext ctx = new PrincipalContext(ContextType.Domain, LDAPServerIP, ADUsername, ADPassword);\r\n            var user = UserPrincipal.FindByIdentity(ctx, IdentityType.UserPrincipalName,  userName);\r\n            return user != null ? user.UserPrincipalName : null;\r\n        }\r\n        public void GetAllUsers()\r\n        {\r\n            PrincipalContext domain = new PrincipalContext(ContextType.Domain, LDAPServerIP, ADUsername, ADPassword);\r\n            PrincipalSearcher search = new PrincipalSearcher(new UserPrincipal(domain));\r\n            foreach (UserPrincipal user in search.FindAll())\r\n            {\r\n                Console.WriteLine(user.DistinguishedName);\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n</code></pre>\n<p> </p>\n", "slug": "how-to-install-active-directory-connect-to-ad-using-c", "date": 1548291634, "cats": [0, 13, 26, 15]}