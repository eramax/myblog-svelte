<script>
  import Jodit from "jodit";
  import { onMount } from "svelte";
  import { BlogStore } from "../Lib/store.js";

  let editor;
  let area;
  let title;

  let access_token = localStorage.getItem("access_token");
  $: localStorage.setItem("access_token", access_token);

  async function submit() {
    let post = {
      date: Math.round(Date.now()) / 1000,
      cats: [0],
      content: editor.value,
      title: title,
      slug: undefined
    };
    await BlogStore.addPost(post);
  }
  onMount(() => {
    editor = Jodit.make(area, {
      askBeforePasteHTML: false,
      processPasteHTML: true,
      removeEmptyBlocks: false,
      defaultActionOnPaste: "insert_clear_html",
      height: "60vh",
      uploader: {
        insertImageAsBase64URI: true
      },
      events: {
        change: function(n) {}
      }
    });
  });
</script>

<article class="w3-container">
  <header class="w3-border-bottom w3-teal">
    <h2>New Post</h2>
  </header>
  <section class="w3-content">
    <form class="w3-row w3-margin">
      <div>
        <label class="w3-text-teal">
          <b>Post title</b>
        </label>
        <input
          bind:value={title}
          class="w3-input w3-border w3-light-grey "
          type="text" />
      </div>

      <textarea bind:this={area} />
      <div class="w3-padding-16">
        <label class="w3-text-teal">
          <b>Github access token</b>
        </label>
        <input
          class="w3-input w3-border w3-light-grey "
          bind:value={access_token}
          type="text" />
      </div>

      <button on:click|preventDefault={submit} class="w3-btn w3-blue-grey">
        Save
      </button>
    </form>
  </section>
</article>
