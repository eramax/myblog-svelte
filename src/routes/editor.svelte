<script context="module">
    export async function load(ctx) {
        let slug = ctx.page.params.id;
        return { props: { slug }}
    }
</script>

<script>
	import { onMount } from 'svelte';
	import { BlogStore } from '../Lib/store.js';
	//import {Editor} from '@toast-ui/editor';
	// import '@toast-ui/editor/dist/toastui-editor.css'; // Editor's Style
  // import "../../node_modules/@toast-ui/editor/dist/toastui-editor.css"
  

	let editor;
	let area;
  let title;
  let newCat = "";
  let cats = []
  let slug = ""
  let access_token = localStorage.getItem("access_token") || "";
  $: localStorage.setItem("access_token", access_token);

  async function save() {}

	onMount(async () => {
    console.log(area)
		editor = new toastui.Editor({
			el: area,
			height: '500px',
			initialEditType: 'markdown',
			//previewStyle: 'vertical'
		});
		editor.getMarkdown();
	});
</script>


<section class="w-full">
  <header class="border-b-2 border-yellow-500 p-4">
      <div class="capitalize text-3xl font-bold mb-2 ">
          Post Editor
      </div>
  </header>

  <form class="w-full py-4 px-8">
      <div class="w-full flex mb-6">
          <div class="w-32">
            <label class="block text-gray-500 font-bold mb-1 pr-4 fon" for="title">
              Post title
            </label>
          </div>
          <div class="w-full">
              <input bind:value={title} class="bg-gray-200 appearance-none border-2 w-full border-gray-200 rounded  py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" id="title" type="text" >
            </div>
          </div>
          
          <textarea  bind:this={area} />

    <div class="w3-row w3-padding-16">
      <div class="w3-text-teal">
        <b>Tags</b>
      </div>
      <div class="w3-row w3-padding-16 hidden">
        {#each $BlogStore.cats as cat}
          <div class="w3-col m4 ">
            <input
              class="w3-check"
              type="checkbox"
              bind:group={cats}
              value={cat.id} />
            <div>{cat.name}</div>
          </div>
        {/each}
      </div>

      <div class="w-full flex mb-6">
          <div class="w-64">
              <label class="block text-gray-500 font-bold mb-1 pr-4 fon" for="newCat">
                  New Tag
              </label>
          </div>
          <div class="w-full">
          <input bind:value={newCat}  class="bg-gray-200 appearance-none border-2 w-full border-gray-200 rounded  py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" id="newCat" type="text" >
          </div>
      </div>


      <div class="w-full flex mb-6">
          <div class="w-64">
              <label class="block text-gray-500 font-bold mb-1 pr-4 fon" for="access_token">
                  Github access token
              </label>
          </div>
          <div class="w-full">
              <input bind:value={access_token}  class="bg-gray-200 appearance-none border-2 w-full border-gray-200 rounded  py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" id="access_token" type="text" >
          </div>
      </div>

      <div class="flex items-center">
          <div class="w-1/3"></div>
          <div class="w-2/3">
            <button on:click|preventDefault={save}  class="shadow bg-gray-500 hover:bg-gray-400 focus:shadow-outline focus:outline-none text-white font-bold py-2 px-4 rounded" type="button">
              Save
            </button>

            <button on:click|preventDefault={async () => await BlogStore.delPost(slug)}  class="shadow bg-red-500 hover:bg-red-400 focus:shadow-outline focus:outline-none text-white font-bold py-2 px-4 rounded" type="button">
              Delete
            </button>
          </div>
        </div>
  </form>
</section>
